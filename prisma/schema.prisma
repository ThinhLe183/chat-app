
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// type LastMessage {
//   id String  @db.ObjectId
//   type MessageType
//   author Author
//   conversation_id String @db.ObjectId
//   msg String
//   mentions String[]
//   attachments String[]
//   ts DateTime @default(now())  
//   updated_at DateTime
// }

// type Author {
//   id String @db.ObjectId
//   username String
//   avatar String?
//   name String
// }
// type Participant {
//   // id String @db.ObjectId
//   // name String
//   // username String
//   // avatar String?
//   nickname String?
//   last_read String? @db.ObjectId //message id
// }
enum ConversationType {
  DM
  GROUP_DM
}
enum MessageType {
  TEXT
  IMAGE
  NOTIFY
}
model User {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  username  String @unique()
  avatar String?
  name String
  email String @unique()
  password String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model Conversation {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  type ConversationType
  name String?
  icon String?
  owner_id String? @db.ObjectId
  participants User[] 
  last_message Message
  total_messages_sent Int @default(0)
  created_at DateTime @default(now())  
  updated_at DateTime @updatedAt
}

model Message {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  type MessageType
  author User
  conversation_id String @db.ObjectId
  msg String
  mentions String[]
  attachments String[]
  ts DateTime @default(now())  
  updated_at DateTime @updatedAt
  @@index([conversation_id,ts(sort: Desc)])
}

